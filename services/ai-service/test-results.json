{
  "timestamp": "2025-11-22T17:06:37.864Z",
  "duration": 618795,
  "prerequisites": {
    "services": [
      {
        "name": "MongoDB",
        "status": "available",
        "required": true,
        "message": "Connected",
        "details": {
          "host": "localhost",
          "port": "27017"
        }
      },
      {
        "name": "Ollama",
        "status": "available",
        "required": true,
        "message": "Available (model may not be installed)",
        "version": "nomic-embed-text:latest, mistral:latest",
        "details": {
          "models": [
            "nomic-embed-text:latest",
            "mistral:latest"
          ],
          "defaultModel": "llama2",
          "modelAvailable": false
        }
      },
      {
        "name": "Pinecone",
        "status": "optional",
        "required": false,
        "message": "API key not configured (optional)"
      },
      {
        "name": "RabbitMQ",
        "status": "available",
        "required": false,
        "message": "Running (Management UI available)",
        "details": {
          "host": "localhost",
          "port": 5672,
          "managementPort": 15672
        }
      },
      {
        "name": "Claude API",
        "status": "optional",
        "required": false,
        "message": "API key not configured (optional)"
      },
      {
        "name": "OpenAI API",
        "status": "optional",
        "required": false,
        "message": "API key not configured (optional)"
      }
    ],
    "allRequiredAvailable": true,
    "timestamp": "2025-11-22T16:56:19.836Z"
  },
  "results": [
    {
      "category": "ask-mode",
      "passed": 3,
      "failed": 1,
      "skipped": 15,
      "total": 19,
      "duration": 1585,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama\n✅ Ollama available, using model: llama2\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should process a simple ask query with Ollama\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should process a simple ask query with Ollama\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should process a simple ask query with Ollama\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should maintain conversation context across multiple queries\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should process a simple ask query with Ollama\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should maintain conversation context across multiple queries\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should maintain conversation context across multiple queries\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should auto-generate sessionId if not provided\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should auto-generate sessionId if not provided\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should maintain conversation context across multiple queries\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should auto-generate sessionId if not provided\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should create and retrieve conversation sessions\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should create and retrieve conversation sessions\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should store and retrieve conversation messages\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should auto-generate sessionId if not provided\n   → Ollama API error: Request failed with status code 404\n ✓ src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should create and retrieve conversation sessions\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should store and retrieve conversation messages\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should store and retrieve conversation messages\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > LLM Provider - Ollama > should generate response using OllamaProvider\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > LLM Provider - Ollama > should generate response using OllamaProvider\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle invalid agent config gracefully\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle invalid agent config gracefully\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle invalid agent config gracefully\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle empty query\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle empty query\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should store and retrieve conversation messages\n   → Ollama API error: Request failed with status code 404\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > LLM Provider - Ollama > should generate response using OllamaProvider\n   → Ollama API error: Request failed with status code 404\n ✓ src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle invalid agent config gracefully\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle empty query\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Default Agent Config > should use default config when configId is not provided\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Default Agent Config > should use default config when configId is not provided\n✅ Connected to RabbitMQ\n\n ✓ src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Error Handling > should handle empty query\n × src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Default Agent Config > should use default config when configId is not provided\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Default Agent Config > should use default config when configId is not provided\n✅ Disconnected from AI Service database\n\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  6 failed | 3 passed | 159 skipped (168)\n   Start at  17:56:20\n   Duration  1.04s (transform 1.11s, setup 0ms, collect 5.17s, tests 384ms, environment 1ms, prepare 1.01s)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\nstderr | src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama\n⚠️  Model \"llama2\" not available in Ollama\n⚠️  Trying default \"llama2\" model\n\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 6 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should process a simple ask query with Ollama\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:114:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/6]⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should maintain conversation context across multiple queries\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:146:25\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/6]⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > AskModeHandler - Basic Ask Flow > should auto-generate sessionId if not provided\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:178:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/6]⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > ConversationService > should store and retrieve conversation messages\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:216:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/6]⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > LLM Provider - Ollama > should generate response using OllamaProvider\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:252:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/6]⎯\n\n FAIL  src/__tests__/integration/ask-mode.integration.test.ts > AI Service Integration Tests - Ask Mode with Ollama > Default Agent Config > should use default config when configId is not provided\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/ask-mode.integration.test.ts:301:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/6]⎯\n\n"
    },
    {
      "category": "llm-providers",
      "passed": 11,
      "failed": 1,
      "skipped": 15,
      "total": 27,
      "duration": 1280,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests\nOllama: ✅\nClaude: ❌\nOpenAI: ❌\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should use OllamaProvider directly\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should use OllamaProvider directly\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should generate response with Claude\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should generate response with Claude\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should use ClaudeProvider directly\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should use ClaudeProvider directly\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should generate response with OpenAI\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should generate response with OpenAI\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should use OpenAIProvider directly\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should use OpenAIProvider directly\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Claude provider for claude- models\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Claude provider for claude- models\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select OpenAI provider for gpt- models\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select OpenAI provider for gpt- models\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama provider for other models\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama provider for other models\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama as default\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama as default\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Switching Providers > should switch between providers in same session\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Switching Providers > should switch between providers in same session\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle unavailable provider gracefully\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle unavailable provider gracefully\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle provider timeout\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\n   → Ollama API error: Request failed with status code 404\n × src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should use OllamaProvider directly\n   → Ollama API error: Request failed with status code 404\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should generate response with Claude\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Claude Provider > should use ClaudeProvider directly\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should generate response with OpenAI\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > OpenAI Provider > should use OpenAIProvider directly\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Claude provider for claude- models\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select OpenAI provider for gpt- models\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama provider for other models\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Provider Factory > should select Ollama as default\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Switching Providers > should switch between providers in same session\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle unavailable provider gracefully\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle provider timeout\n✅ Connected to RabbitMQ\n\n ✓ src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle provider timeout\nstdout | src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Error Handling > should handle provider timeout\n✅ Disconnected from AI Service database\n\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  2 failed | 11 passed | 155 skipped (168)\n   Start at  17:56:21\n   Duration  890ms (transform 1.05s, setup 1ms, collect 4.76s, tests 329ms, environment 2ms, prepare 913ms)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should generate response with Ollama\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/llm-providers.integration.test.ts:108:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯\n\n FAIL  src/__tests__/integration/llm-providers.integration.test.ts > LLM Providers Integration Tests > Ollama Provider > should use OllamaProvider directly\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ src/__tests__/integration/llm-providers.integration.test.ts:134:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯\n\n"
    },
    {
      "category": "graphql-api",
      "passed": 1,
      "failed": 1,
      "skipped": 15,
      "total": 17,
      "duration": 1254,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests\n✅ Connected to AI Service MongoDB database\nEnabling inline tracing for this subgraph. To disable, use ApolloServerPluginInlineTraceDisabled.\n✅ Test GraphQL server started at http://localhost:62102/\n\nstdout | src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should process ask query via GraphQL API with Ollama\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should process ask query via GraphQL API with Ollama\n   → Cannot read properties of null (reading 'ask')\n ✓ src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should require authentication\n × src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should auto-generate sessionId when not provided\n   → Cannot read properties of null (reading 'ask')\nstdout | src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > conversation Query > should retrieve conversation history via GraphQL\n   → Cannot read properties of null (reading 'ask')\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  3 failed | 1 passed | 164 skipped (168)\n   Start at  17:56:23\n   Duration  872ms (transform 806ms, setup 2ms, collect 4.57s, tests 197ms, environment 1ms, prepare 955ms)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 3 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should process ask query via GraphQL API with Ollama\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/graphql-api.integration.test.ts:207:33\n    205|       expect(response.status).toBe(200);\n    206|       expect(response.data.data).toBeDefined();\n    207|       expect(response.data.data.ask).toBeDefined();\n       |                                 ^\n    208|       \n    209|       const askResponse = response.data.data.ask;\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/3]⎯\n\n FAIL  src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > ask Mutation > should auto-generate sessionId when not provided\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/graphql-api.integration.test.ts:270:33\n    268| \n    269|       expect(response.status).toBe(200);\n    270|       expect(response.data.data.ask.sessionId).toBeDefined();\n       |                                 ^\n    271|       testSessionIds.push(response.data.data.ask.sessionId);\n    272|     }, 60000);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/3]⎯\n\n FAIL  src/__tests__/integration/graphql-api.integration.test.ts > AI Service GraphQL API Integration Tests > conversation Query > should retrieve conversation history via GraphQL\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/graphql-api.integration.test.ts:302:47\n    300|       );\n    301| \n    302|       const sessionId = askResponse.data.data.ask.sessionId;\n       |                                               ^\n    303|       testSessionIds.push(sessionId);\n    304| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/3]⎯\n\n"
    },
    {
      "category": "configuration",
      "passed": 20,
      "failed": 1,
      "skipped": 15,
      "total": 36,
      "duration": 1207,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should use MongoDB by default\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should use MongoDB when explicitly set\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should use LocalFile when configured\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should use Pinecone when configured with API key\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should fallback to MongoDB if Pinecone fails\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Memory System Types > should use Local by default\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Memory System Types > should use Local when explicitly set\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Memory System Types > should use Pinecone when configured with API key\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Memory System Types > should fallback to Local if Pinecone fails\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Stream Manager Types > should use SSE by default\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Stream Manager Types > should use SSE when explicitly set\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Stream Manager Types > should use WebSocket when configured\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Tool Registry Types > should use Local by default\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Tool Registry Types > should use Local when explicitly set\n × src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Tool Registry Types > should use MCP when configured\n   → MCPToolRegistry requires baseUrl in config\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Environment Variable Parsing > should parse MongoDB URI correctly\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Environment Variable Parsing > should use default database name if not in URI\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Environment Variable Parsing > should configure Ollama embeddings for Pinecone\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Default Configuration Fallbacks > should use sensible defaults when env vars not set\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Invalid Configuration Handling > should handle invalid context manager type\n ✓ src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Invalid Configuration Handling > should handle invalid memory system type\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  1 failed | 20 passed | 147 skipped (168)\n   Start at  17:56:24\n   Duration  817ms (transform 867ms, setup 0ms, collect 4.62s, tests 19ms, environment 2ms, prepare 913ms)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\nstderr | src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Context Manager Types > should fallback to MongoDB if Pinecone fails\n⚠️  Pinecone initialization failed, falling back to MongoDB: The client configuration must have required property: apiKey. You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io.\n\nstderr | src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Memory System Types > should fallback to Local if Pinecone fails\n⚠️  Pinecone Memory System initialization failed, falling back to Local: The client configuration must have required property: apiKey. You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io.\n\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/configuration.integration.test.ts > Configuration Integration Tests > Tool Registry Types > should use MCP when configured\nError: MCPToolRegistry requires baseUrl in config\n ❯ Function.create ../../shared/src/kernel/tool-registry/factory.ts:22:17\n ❯ new KernelAdapter src/kernel/KernelAdapter.ts:84:45\n     82|     // Initialize Tool Registry\n     83|     const toolRegistryType = (process.env.TOOL_REGISTRY_TYPE || 'local…\n     84|     this.toolRegistry = ToolRegistryFactory.create(toolRegistryType);\n       |                                             ^\n     85|   }\n     86| \n ❯ src/__tests__/integration/configuration.integration.test.ts:126:23\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯\n\n"
    },
    {
      "category": "error-handling",
      "passed": 3,
      "failed": 1,
      "skipped": 15,
      "total": 19,
      "duration": 301686,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle non-existent config ID\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle non-existent config ID\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle non-existent config ID\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle config ID for different user\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle config ID for different user\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing Claude API key gracefully\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing Claude API key gracefully\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing OpenAI API key gracefully\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing OpenAI API key gracefully\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully\n✅ Connected to AI Service MongoDB database\n\n ✓ src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle non-existent config ID\n ✓ src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Agent Config > should handle config ID for different user\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing Claude API key gracefully\n   → expected [Function] to throw error including 'ANTHROPIC_API_KEY environment variabl…' but got 'Cannot find module \\'../../services/l…'\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Missing API Keys > should handle missing OpenAI API key gracefully\n   → expected [Function] to throw error including 'OPENAI_API_KEY environment variable i…' but got 'Cannot find module \\'../../services/l…'\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully\n<empty line>\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully\n✅ Disconnected from AI Service database\n\n ✓ src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully 30023ms\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle empty query\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle empty query 30024ms\n   → getaddrinfo ENOTFOUND invalid-host\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle whitespace-only query\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle whitespace-only query\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle whitespace-only query 30211ms\n   → getaddrinfo ENOTFOUND invalid-host\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle very long query\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle very long query\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle very long query 30020ms\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Authentication Failures > should handle missing userId\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Authentication Failures > should handle missing userId 30012ms\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Service Unavailability > should handle RabbitMQ unavailability gracefully\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Service Unavailability > should handle RabbitMQ unavailability gracefully 30014ms\n   → getaddrinfo ENOTFOUND invalid-host\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Service Unavailability > should handle Pinecone unavailability gracefully\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Service Unavailability > should handle Pinecone unavailability gracefully\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Service Unavailability > should handle Pinecone unavailability gracefully 30018ms\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > LLM Provider Errors > should handle provider timeout\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > LLM Provider Errors > should handle provider timeout 30016ms\n   → getaddrinfo ENOTFOUND invalid-host\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > LLM Provider Errors > should handle invalid model name\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > LLM Provider Errors > should handle invalid model name\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > LLM Provider Errors > should handle invalid model name 30022ms\n   → getaddrinfo ENOTFOUND invalid-host\nstdout | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Malformed Responses > should handle null response from LLM\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Malformed Responses > should handle null response from LLM 30009ms\n   → getaddrinfo ENOTFOUND invalid-host\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  11 failed | 3 passed | 154 skipped (168)\n   Start at  17:56:25\n   Duration  301.23s (transform 836ms, setup 1ms, collect 4.69s, tests 300.45s, environment 2ms, prepare 933ms)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully\n❌ Database connection error: MongoServerSelectionError: getaddrinfo ENOTFOUND invalid-host\n    at Topology.selectServer (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:635:30)\n    at Topology._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:467:22)\n    at Topology.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:404:7)\n    at topologyConnect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:695:9)\n    at MongoClient._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:707:7)\n    at MongoClient.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:619:7)\n    at Database.connect (/Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/database.ts:25:7)\n    at /Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/__tests__/integration/error-handling.integration.test.ts:102:9\n    at /Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/__tests__/integration/error-handling.integration.test.ts:100:7\n    at runTest (file:///Users/yab/Projects/v6-clear-ai/backend/node_modules/@vitest/runner/dist/index.js:781:11) {\n  errorLabelSet: Set(0) {},\n  reason: TopologyDescription {\n    type: 'Unknown',\n    servers: Map(1) { 'invalid-host:27017' => [ServerDescription] },\n    stale: false,\n    compatible: true,\n    heartbeatFrequencyMS: 10000,\n    localThresholdMS: 15,\n    setName: null,\n    maxElectionId: null,\n    maxSetVersion: null,\n    commonWireVersion: 0,\n    logicalSessionTimeoutMinutes: null\n  },\n  code: undefined,\n  [cause]: MongoNetworkError: getaddrinfo ENOTFOUND invalid-host\n      at Socket.<anonymous> (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/cmap/connect.ts:395:16)\n      at Object.onceWrapper (node:events:634:26)\n      at Socket.emit (node:events:519:28)\n      at emitErrorNT (node:internal/streams/destroy:170:8)\n      at emitErrorCloseNT (node:internal/streams/destroy:129:3)\n      at processTicksAndRejections (node:internal/process/task_queues:90:21) {\n    errorLabelSet: Set(1) { 'ResetPool' },\n    beforeHandshake: false,\n    [cause]: Error: getaddrinfo ENOTFOUND invalid-host\n        at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {\n      errno: -3008,\n      code: 'ENOTFOUND',\n      syscall: 'getaddrinfo',\n      hostname: 'invalid-host'\n    }\n  }\n}\n\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Database Connection Failures > should handle MongoDB connection failure gracefully\n<empty line>\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle empty query\n❌ Database connection error: MongoServerSelectionError: getaddrinfo ENOTFOUND invalid-host\n    at Topology.selectServer (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:635:30)\n    at Topology._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:467:22)\n    at Topology.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:404:7)\n    at topologyConnect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:695:9)\n    at MongoClient._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:707:7)\n    at MongoClient.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:619:7)\n    at Database.connect (/Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/database.ts:25:7)\n    at /Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/__tests__/integration/error-handling.integration.test.ts:26:5\n    at async Promise.all (index 0)\n    at callSuiteHook (file:///Users/yab/Projects/v6-clear-ai/backend/node_modules/@vitest/runner/dist/index.js:700:23) {\n  errorLabelSet: Set(0) {},\n  reason: TopologyDescription {\n    type: 'Unknown',\n    servers: Map(1) { 'invalid-host:27017' => [ServerDescription] },\n    stale: false,\n    compatible: true,\n    heartbeatFrequencyMS: 10000,\n    localThresholdMS: 15,\n    setName: null,\n    maxElectionId: null,\n    maxSetVersion: null,\n    commonWireVersion: 0,\n    logicalSessionTimeoutMinutes: null\n  },\n  code: undefined,\n  [cause]: MongoNetworkError: getaddrinfo ENOTFOUND invalid-host\n      at Socket.<anonymous> (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/cmap/connect.ts:395:16)\n      at Object.onceWrapper (node:events:634:26)\n      at Socket.emit (node:events:519:28)\n      at emitErrorNT (node:internal/streams/destroy:170:8)\n      at emitErrorCloseNT (node:internal/streams/destroy:129:3)\n      at processTicksAndRejections (node:internal/process/task_queues:90:21) {\n    errorLabelSet: Set(1) { 'ResetPool' },\n    beforeHandshake: false,\n    [cause]: Error: getaddrinfo ENOTFOUND invalid-host\n        at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {\n      errno: -3008,\n      code: 'ENOTFOUND',\n      syscall: 'getaddrinfo',\n      hostname: 'invalid-host'\n    }\n  }\n}\n\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle empty query\n<empty line>\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle whitespace-only query\n❌ Database connection error: MongoServerSelectionError: getaddrinfo ENOTFOUND invalid-host\n    at Topology.selectServer (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:635:30)\n    at Topology._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:467:22)\n    at Topology.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:404:7)\n    at topologyConnect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:695:9)\n    at MongoClient._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:707:7)\n    at MongoClient.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:619:7)\n    at Database.connect (/Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/database.ts:25:7)\n    at /Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/__tests__/integration/error-handling.integration.test.ts:26:5\n    at async Promise.all (index 0)\n    at callSuiteHook (file:///Users/yab/Projects/v6-clear-ai/backend/node_modules/@vitest/runner/dist/index.js:700:23) {\n  errorLabelSet: Set(0) {},\n  reason: TopologyDescription {\n    type: 'Unknown',\n    servers: Map(1) { 'invalid-host:27017' => [ServerDescription] },\n    stale: false,\n    compatible: true,\n    heartbeatFrequencyMS: 10000,\n    localThresholdMS: 15,\n    setName: null,\n    maxElectionId: null,\n    maxSetVersion: null,\n    commonWireVersion: 0,\n    logicalSessionTimeoutMinutes: null\n  },\n  code: undefined,\n  [cause]: MongoNetworkError: getaddrinfo ENOTFOUND invalid-host\n      at Socket.<anonymous> (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/cmap/connect.ts:395:16)\n      at Object.onceWrapper (node:events:634:26)\n      at Socket.emit (node:events:519:28)\n      at emitErrorNT (node:internal/streams/destroy:170:8)\n      at emitErrorCloseNT (node:internal/streams/destroy:129:3)\n      at processTicksAndRejections (node:internal/process/task_queues:90:21) {\n    errorLabelSet: Set(1) { 'ResetPool' },\n    beforeHandshake: false,\n    [cause]: Error: getaddrinfo ENOTFOUND invalid-host\n        at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {\n      errno: -3008,\n      code: 'ENOTFOUND',\n      syscall: 'getaddrinfo',\n      hostname: 'invalid-host'\n    }\n  }\n}\n\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle whitespace-only query\n<empty line>\nstderr | src/__tests__/integration/error-handling.integration.test.ts > Error Handling Integration Tests > Invalid Query Formats > should handle very long query\n❌ Database connection error: MongoServerSelectionError: getaddrinfo ENOTFOUND invalid-host\n    at Topology.selectServer (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:635:30)\n    at Topology._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:467:22)\n    at Topology.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/sdam/topology.ts:404:7)\n    at topologyConnect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:695:9)\n    at MongoClient._connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:707:7)\n    at MongoClient.connect (/Users/yab/Projects/v6-clear-ai/backend/node_modules/mongodb/src/mongo_client.ts:619:7)\n    at Database.connect (/Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/database.ts:25:7)\n    at /Users/yab/Projects/v6-clear-ai/backend/services/ai-service/src/__tests__/integration/error-handling.integration.test.ts:26:5\n    at async Promise.all (index 0)\n    at callSuiteHook (file:///Users/yab/Projects/v6-clear-ai/backend/node_modules/@vitest/runner/dist/index.js:700:23) {\n  errorLabelSet: Set(0) {},\n  reason: TopologyDescription {\n    type: 'Unknown',\n    servers: Map(1) { 'invalid-host:27017' => [ServerDescription] },\n    stale: false,\n    compati"
    },
    {
      "category": "conversation-persistence",
      "passed": 0,
      "failed": 1,
      "skipped": 15,
      "total": 16,
      "duration": 3020,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should handle large conversation history\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should handle large conversation history\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should handle large conversation history\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain message ordering\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should handle large conversation history\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain message ordering\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain message ordering\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain timestamps correctly\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain timestamps correctly\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain message ordering\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain timestamps correctly\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain timestamps correctly\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\n   → Ollama API error: Request failed with status code 404\n × src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\n✅ Disconnected from AI Service database\n\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  5 failed | 163 skipped (168)\n   Start at  18:01:27\n   Duration  1.88s (transform 2.67s, setup 0ms, collect 11.14s, tests 351ms, environment 2ms, prepare 3.32s)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 5 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should persist conversation across service restarts\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/conversation-persistence.integration.test.ts:95:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯\n\n FAIL  src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should handle large conversation history\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/conversation-persistence.integration.test.ts:133:9\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯\n\n FAIL  src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain message ordering\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/conversation-persistence.integration.test.ts:157:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯\n\n FAIL  src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should maintain timestamps correctly\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/conversation-persistence.integration.test.ts:195:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯\n\n FAIL  src/__tests__/integration/conversation-persistence.integration.test.ts > Conversation Persistence Integration Tests > Conversation Persistence > should sync Context Manager and MongoDB\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/conversation-persistence.integration.test.ts:225:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯\n\n"
    },
    {
      "category": "events",
      "passed": 1,
      "failed": 1,
      "skipped": 15,
      "total": 17,
      "duration": 2623,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests\n⚠️  RabbitMQ connection closed\n✅ Disconnected from RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event 541ms\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.generated event\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.generated event\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.generated event\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.sent event\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.generated event\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.sent event\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.sent event\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit error event on failure\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.sent event\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit error event on failure\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit error event on failure\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include correct payload structure in query.received event\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include correct payload structure in query.received event\n✅ Connected to RabbitMQ\n\n ✓ src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit error event on failure\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include correct payload structure in query.received event\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include tokensUsed in response.generated event\n✅ Connected to AI Service MongoDB database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include tokensUsed in response.generated event\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include correct payload structure in query.received event\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include tokensUsed in response.generated event\n✅ Disconnected from AI Service database\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n✅ Connected to AI Service MongoDB database\n\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include tokensUsed in response.generated event\n   → Ollama API error: Request failed with status code 404\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n✅ Connected to RabbitMQ\n\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n<empty line>\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n<empty line>\n × src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n   → getaddrinfo ENOTFOUND invalid\nstdout | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n✅ Disconnected from AI Service database\n\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  6 failed | 1 passed | 161 skipped (168)\n   Start at  18:01:30\n   Duration  2.14s (transform 1.69s, setup 1ms, collect 12.27s, tests 808ms, environment 2ms, prepare 2.37s)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\nstderr | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n❌ Failed to connect to RabbitMQ: Error: getaddrinfo ENOTFOUND invalid\n    at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {\n  errno: -3008,\n  code: 'ENOTFOUND',\n  syscall: 'getaddrinfo',\n  hostname: 'invalid'\n}\n\nstderr | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n❌ Failed to connect to RabbitMQ: Error: getaddrinfo ENOTFOUND invalid\n    at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {\n  errno: -3008,\n  code: 'ENOTFOUND',\n  syscall: 'getaddrinfo',\n  hostname: 'invalid'\n}\n\nstderr | src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\n<empty line>\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 6 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit query.received event\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/event-emission.integration.test.ts:124:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/6]⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.generated event\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/event-emission.integration.test.ts:153:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/6]⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Emission > should emit response.sent event\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/event-emission.integration.test.ts:180:24\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/6]⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include correct payload structure in query.received event\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/event-emission.integration.test.ts:230:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/6]⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Payload Validation > should include tokensUsed in response.generated event\nError: Ollama API error: Request failed with status code 404\n ❯ OllamaProvider.generateResponse src/services/llm/OllamaProvider.ts:101:15\n     99|           );\n    100|         }\n    101|         throw new Error(`Ollama API error: ${error.message}`);\n       |               ^\n    102|       }\n    103|       throw error;\n ❯ AskModeHandler.handle src/handlers/AskModeHandler.ts:58:27\n ❯ src/__tests__/integration/event-emission.integration.test.ts:261:7\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/6]⎯\n\n FAIL  src/__tests__/integration/event-emission.integration.test.ts > Event Emission Integration Tests > Event Bus Graceful Degradation > should work with no-op event bus when RabbitMQ unavailable\nError: getaddrinfo ENOTFOUND invalid\n ❯ GetAddrInfoReqWrap.onlookupall [as oncomplete] node:dns:122:26\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nSerialized Error: { errno: -3008, code: 'ENOTFOUND', syscall: 'getaddrinfo', hostname: 'invalid' }\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/6]⎯\n\n"
    },
    {
      "category": "federation",
      "passed": 2,
      "failed": 1,
      "skipped": 15,
      "total": 18,
      "duration": 2500,
      "stdout": "\n RUN  v1.6.1 /Users/yab/Projects/v6-clear-ai/backend/services/ai-service\n\nstdout | src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests\n✅ Connected to AI Service MongoDB database\nEnabling inline tracing for this subgraph. To disable, use ApolloServerPluginInlineTraceDisabled.\n\nstdout | src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Agent Config Federation > should fetch agent config from MongoDB (simulating federation)\n✅ Connected to RabbitMQ\n\n × src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Agent Config Federation > should fetch agent config from MongoDB (simulating federation)\n   → Cannot read properties of null (reading 'ask')\n × src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Authentication Token Forwarding > should forward authentication token correctly\n   → Cannot read properties of null (reading 'ask')\n ✓ src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Authentication Token Forwarding > should reject requests without authentication\nstdout | src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests\n✅ Disconnected from AI Service database\n\n × src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Cross-Service Queries > should handle queries that would require federation\n   → Cannot read properties of null (reading 'ask')\n ✓ src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Error Handling in Federated Queries > should handle missing agent config gracefully\n\n Test Files  1 failed | 15 skipped (16)\n      Tests  3 failed | 2 passed | 163 skipped (168)\n   Start at  18:01:32\n   Duration  2.00s (transform 1.78s, setup 0ms, collect 12.35s, tests 264ms, environment 2ms, prepare 2.53s)\n\n",
      "stderr": "\u001b[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.\u001b[39m\n⎯⎯⎯⎯⎯⎯⎯ Failed Tests 3 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Agent Config Federation > should fetch agent config from MongoDB (simulating federation)\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/federation.integration.test.ts:175:33\n    173| \n    174|       expect(response.status).toBe(200);\n    175|       expect(response.data.data.ask).toBeDefined();\n       |                                 ^\n    176|       expect(response.data.data.ask.model).toBe(ollamaModel);\n    177|       testSessionIds.push(response.data.data.ask.sessionId);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/3]⎯\n\n FAIL  src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Authentication Token Forwarding > should forward authentication token correctly\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/federation.integration.test.ts:215:33\n    213| \n    214|       expect(response.status).toBe(200);\n    215|       expect(response.data.data.ask).toBeDefined();\n       |                                 ^\n    216|     }, 60000);\n    217| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/3]⎯\n\n FAIL  src/__tests__/integration/federation.integration.test.ts > GraphQL Federation Integration Tests > Cross-Service Queries > should handle queries that would require federation\nTypeError: Cannot read properties of null (reading 'ask')\n ❯ src/__tests__/integration/federation.integration.test.ts:285:47\n    283|       );\n    284| \n    285|       const sessionId = askResponse.data.data.ask.sessionId;\n       |                                               ^\n    286|       testSessionIds.push(sessionId);\n    287| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/3]⎯\n\n"
    }
  ],
  "summary": {
    "totalTests": 169,
    "totalPassed": 41,
    "totalFailed": 8,
    "totalSkipped": 120,
    "success": false
  }
}